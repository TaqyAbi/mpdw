---
title: "MPDW Praktikum P4"
output:
  html_document:
    self_contained: true
    thumbnails: false
    lightbox: true
    gallery: true
    highlight: tango
    code_folding: show
    toc_depth: 5
    number_sections: false
    theme: flatly
    toc: yes
    toc_float:
      collapsed: true
      smooth_scroll: true
    fig_caption: true
editor_options: 
  markdown: 
    wrap: 72
---

# White Noise

```{r}
set.seed(1043)
wn <- rnorm(300)
ts.plot(wn)
```

# MA(2)

Proses MA dapat dituliskan sebagai berikut:

$$
y_{t} = c + e_t + \theta_{1}e_{t-1} + \theta_{2}e_{t-2} + \dots + \theta_{q}e_{t-q} = c+{e_t+\sum_{i=1}^p \theta_ie_{t-i}}
$$

Terlihat bahwa $e_t$, atau *white noise*, berperan penting dalam
pembangkitan proses MA.

## Pembangkitan

### Pembangkitan secara Manual

```{r}
set.seed(1043)
wn <- rnorm(300)   # white noise
ma_manual <- rep(0, 300)

for(i in 3:300){
  ma_manual[i] <- wn[i] + 0.4*wn[i-1] + 0.6*wn[i-2]
}
ts.plot(ma_manual, main="Simulasi MA(2) Manual")
```

Sebelum membangkitkan data MA(2), diberikan seed(1043) agar hasil data
bangkitan konsisten dan tidak berubah-ubah. Sesuai ketentuan yang
diberikan, data yang dibangkitkan akan memiliki persamaan:

$$
y_t = e_t+0.4e_{t-1}+0.6e_{t-2}
$$\

### Pembangkitan dengan Function `arima.sim()`

Selain menggunakan cara di atas, pembangkitan proses MA(2) dapat
dilakukan dengan fungsi `arima.sim()` sebagai berikut.

```{r}
set.seed(1043)
ma2 <- arima.sim(list(order=c(0,0,2), ma=c(0.4, 0.6)), n=300)
ts.plot(ma2, main="Simulasi MA(2) dengan arima.sim")
```

## Karakteristik MA(2)

### Plot Time Series

```{r}
par(mfrow = c(1, 2))
ts.plot(ma2)
ts.plot(ma_manual)
```

Berdasarkan plot time series, terlihat bahwa data MA(2) menyebar
disekitar 0 dan memiliki keragaman yang cenderung homogen sehingga bisa
dikatakan stasioner dalam rataan.

### Plot ACF

```{r}
acf(ma2,lag.max = 20)
```

Berdasarkan plot ACF tersebut, terlihat bahwa plot ACF *cuts off* di lag
Kedua

### Plot PACF

```{r}
pacf(ma2)
```

Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cenderung
*tails off* dan membentuk gelombang sinus.

### Plot EACF

```{r}
TSA::eacf(ma2)
```

Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga
nol berada pada ordo AR(0) dan ordo MA(2)

## Scatterplot Antar Lag

### Korelasi antara $Y_t$ dengan $Y_{t-1}$

```{r}
#Yt
yt_ma <- ma2[-1]
head(yt_ma)
#Yt-1
yt_1_ma <- ma2[-300]
head(yt_1_ma)
```

```{r}
plot(y=yt_ma,x=yt_1_ma, main="Yt vs Yt-1")
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan
positif antara $Y_t$ dengan $Y_{t-1}$. Hal ini sesuai dengan teori yang
ada

```{r}
cor(yt_ma,yt_1_ma)
```

Korelasi antara $Y_t$ dengan $Y_{t-1}$ dari hasil simulasi mendekati
perhitungan teoritis yaitu

$$
\rho_1=\frac{\theta_1+\theta_1\theta_2}{1+(\theta_1)^2+(\theta_2)^2}=\frac{0.4+(0.4)(0.6)}{1+(0.4)^2+(0.6)^2}=0.4211
\\
\rho_k = 0\ untuk\ k>2 
$$

### Korelasi antara $Y_t$ dengan $Y_{t-2}$

```{r}
#Yt
yt_ma2 <- ma2[-c(1,2)]
head(yt_ma2)
#Yt-2
yt_2_ma <- ma2[-c(299,300)]
head(yt_2_ma)
```

```{r}
plot(y=yt_ma2,x=yt_2_ma, main="Yt vs Yt-2")
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan
positif antara $Y_t$ dengan $Y_{t-2}$.Model MA(2) secara teoretis
memiliki autokorelasi yang tidak nol pada lag 2. Scatter plot ini adalah
bukti visual dari autokorelasi tersebut.

```{r}
cor(yt_ma2,yt_2_ma)
```

Korelasi antara $Y_t$ dengan $Y_{t-2}$ hasil simulasi menunjukkan
korelasi lag 2 sebesar 0.3295534 (nilai yang jauh dari nol) adalah bukti
yang mendukung bahwa data tersebut memang berasal dari proses MA(2).

$$\rho_2 = \frac{\theta_2}{1+\theta_1^2+\theta_2^2} = \frac{0.6}{1 + (0.4)^2 + (0.6)^2} = \frac{0.6}{1.52} = 0.3947$$

### Korelasi antara $Y_t$ dengan $Y_{t-3}$

```{r}
#Yt
yt_ma3 <- ma2[-c(1,2,3)]
head(yt_ma3)
#Yt-2
yt_3_ma <- ma2[-c(298,299,300)]
head(yt_3_ma)
```

```{r}
plot(yt_ma3,yt_3_ma , main="Yt vs Yt-3")
```

Berdasarkan scatterplot tersebut, terlihat bahwa polanya menyebar acak
dan cenderung tidak terdapat hubungan antara $Y_t$ dengan $Y_{t-3}$.

```{r}
cor(yt_ma3, yt_3_ma)
```

Korelasi antara $Y_t$ dengan $Y_{t-3}$ hasil simulasi sebesar -0.0977
sangat mendekati teori yang ada, yaitu 0. Hal ini sejalan dengan teori
model MA(2) di mana autokorelasi teoretisnya pada lag 3 adalah nol
$\rho_3=0$.

```{r}

```

# AR (2)

Proses AR dapat dituliskan sebagai berikut:

$$ y_{t} = c + e_t + \phi_{1}Y_{t-1} + \phi_{2}Y_{t-2} + \dots + \phi_{q}Y_{t-q} = c+{e_t+\sum_{i=1}^p \phi_iY_{t-i}} $$
Terlihat bahwa $Y_t$ berperan penting dalam pembangkitan proses AR.

## Pembangkitan Proses AR

Nilai-nilai selanjutnya dapat dicari melalui *loop*. Bentuk loop dapat
dilihat dari rumus AR(2) yang hendak dibangkitkan:

$$ Y_t = e_t + 0.5Y_{t-1} + 0.2Y_{t-2} $$\

### Pembangkitan Manual

```{r}
set.seed(1043)
n <- length(wn)
ar_manual <- numeric(n)

ar_manual[1] <- wn[1]
ar_manual[2] <- wn[2] + 0.5 * ar_manual[1]

for (i in 3:n) {
  ar_manual[i] <- wn[i] + 0.5 * ar_manual[i-1] + 0.2 * ar_manual[i-2]
}

head(ar_manual)
```

### Pembangkitan dengan fungsi `arima.sim()`

```{r}
# Membangkitkan model AR(2)
ar_sim <- arima.sim(list(order = c(2,0,0), ar = c(0.5, 0.2)), n = 300)
head(ar_sim, 10)
```

## Karakteristik AR(2)

### Plot Time Series

```{r}
par(mfrow = c(1, 2))
ts.plot(ar_manual, main="Plot Time Series AR(2) manual", ylab="Yt")
abline(h=0, col="red", lty=2)
ts.plot(ar_sim, main="Plot Time Series AR(2) function", ylab="Yt")
abline(h=0, col="red", lty=2)
```

Berdasarkan plot time series tersebut terlihat bahwa data cenderung
stasioner pada rataan

### Plot ACF

```{r}
par(mfrow = c(1, 2))
acf(ar_manual, main="Autocorrelation Function (ACF)")
acf(ar_sim, main="Autocorrelation Function (ACF)")
```

Berdasarkan plot ACF tersebut terlihat bahwa plot ACF cenderung *tails
off*

### Plot PACF

```{r}
par(mfrow = c(1, 2))
pacf(ar_manual, main="Partial Autocorrelation Function (PACF) Manual")
pacf(ar_sim, main="Partial Autocorrelation Function (PACF) Fungsi")
```

Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF *cuts off* pada
lag kedua, sejalan dengan teori yang ada.

### Plot EACF

```{r}
TSA::eacf(ar_manual)
TSA::eacf(ar_sim)
```

Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga
nol berada pada ordo AR(1) dan ordo MA(1). Tetapi ada Noise pada ordo
AR(6) dan ordo MA(7).

### Scatterplot Antar Lag

#### Korelasi antara $Y_t$ dengan $Y_{t-1}$

```{r}
yt   <- ar_sim[-1]
yt_1 <- ar_sim[-300]
head(yt_1)
```

```{r}
plot(y=yt,x=yt_1, main="Scatterplot Yt vs Yt-1",
     xlab="Yt-1", ylab="Yt")
```

Terlihat dengan jelas adanya pola linear positif yang kuat. Ini
mengindikasikan adanya autokorelasi positif yang sangat kuat pada lag 1.

```{r}
cor(yt,yt_1)
```

Perhitungan teoritis yaitu
$\rho_1=\phi_1 / (1 - \phi_2)=0.5 / (1 - 0.2) = 0.625$

Korelasi antara $Y_t$ dengan $Y_t−1$ dari hasil simulasi, atau
autokorelasi sampel lag 1 (r1), adalah sebesar 0.5657. Nilai ini sangat
mendekati nilai teoretisnya $\rho_1$ yaitu 0.6250.

#### Korelasi antara $Y_t$ dengan $Y_{t-2}$

```{r}
yt__2 <- ar_sim[-c(1,2)]
yt_2 <- ar_sim[-c(299,300)]
head(yt_2)
```

```{r}
plot(y=yt__2,x=yt_2, main="Scatterplot Yt vs Yt-2",
     xlab="Yt-2", ylab="Yt")
```

Berdasarkan scatterplot terlihat adanya pola linear positif, namun lebih
lemah dan lebih tersebar dibandingkan dengan plot lag 1. Walaupun ada
tren menaik, sebaran titiknya lebih luas. Ini menandakan adanya
autokorelasi positif yang signifikan (namun tidak sekuat lag 1) pada lag
2.

```{r}
cor(yt__2,yt_2)
```

Perhitungan Teoritisnya adalah sebagai berikut
$$\rho_2=\phi_1 * \rho_1 + \phi_2 * \rho_0=(0.5)(0.625)+(0.2)(1)=0.5125$$

Korelasi antara $Y_t$ dengan $Y_t−2$ dari hasil simulasi, atau
autokorelasi sampel lag 2 (r2), adalah sebesar 0.4345972. Nilai ini
sangat mendekati nilai teoretisnya $\rho_2$ yaitu 0.5125.

```{r}
yt__3 <- ar_sim[-c(1,2,3)]
yt_3 <- ar_sim[-c(298,299,300)]
head(yt_3)
```

```{r}
plot(y = yt__3, x = yt_3, main="Scatterplot Yt vs Yt-3",
     xlab="Yt-3", ylab="Yt")
```

Berdasarkan scatterplot dapat terlihat bahwa titik-titik tersebar secara
acak dan tidak terdapat pola linier yang jelas. Hal ini menandakan bahwa
autokorelasi lag 3 sudah tidak signifikan atau mendekati nol.

```{r}
cor(yt__3,yt_3)
```

Perhitungan Teoritisnya adalah sebagai berikut
$$\rho_3=\phi_1\rho_2+\phi_2\rho_1=(0.5)(0.5125)+(0.2)(0.625)=0.38125$$

Korelasi antara $Y_t$ dengan $Y_t−3$ dari hasil simulasi, atau
autokorelasi sampel lag 3 (r3), adalah sebesar 0.2853171. Nilai ini
masih sejalan dengan nilai teoretisnya $\rho_3$ yaitu 0.38125.

```{r}
phi1 <- 0.5
phi2 <- 0.2

rho <- numeric(4)
rho[1] <- 1
rho[2] <- phi1 / (1 - phi2)
rho[3] <- phi1 * rho[2] + phi2 * rho[1]
rho[4] <- phi1 * rho[3] + phi2 * rho[2]

rho
```

# ARMA (2,2)

## Pembangkitan Data

### Pembangkitan Manual

```{r}
set.seed(1043)
n <- 300
phi1 <- 0.5
phi2 <- 0.2
theta1 <- 0.4
theta2 <- 0.6

y.arma <- numeric(n)
y.arma[1:2] <- wn[1:2]

for (i in 3:n){
  y.arma[i] <- phi1 * y.arma[i-1] +
             phi2 * y.arma[i-2] +
             wn[i] +
             theta1 * wn[i-1] +
             theta2 * wn[i-2]
}

y.arma <- ts(y.arma)
head(y.arma)
```

### Pembangkitan ARMA(2,2) dengan fungsi `arima.sim`

```{r}
set.seed(1043)
arma22_fungsi <- arima.sim(list(order=c(2,0,2), ma=c(0.4, 0.6), ar=c(0.5, 0.2)), n=300)
head(arma22_fungsi)
```

## Karakteristik ARMA(2,2)

### Plot Time Series

```{r}
par(mfrow = c(1, 2))
ts.plot(arma22_fungsi, main = "Plot Time Series ARMA(2,2) Fungsi", 
     ylab = "Nilai Yt", xlab = "Waktu", col = "darkgreen")
ts.plot(y.arma, main = "Plot Time Series ARMA(2,2) Manual", 
     ylab = "Nilai Yt", xlab = "Waktu", col = "darkgreen")
```

Berdasarkan plot time series tersebut, terlihat bahwa model ARMA(2,2)
cenderung stasioner dalam rataan

### Plot ACF

```{r}
par(mfrow=c(1, 2)) 
acf(arma22_fungsi, main="ACF dari Data ARMA(2,2) fungsi")
acf(y.arma, main="ACF dari Data ARMA(2,2) manual")
```

Berdasarkan plot ACF tersebut, terlihat bahwa model ARMA(2,2) hasil
simulasi memiliki plot ACF yang *tails off* pada lag kedua dan
seterusnya. Hal ini membuktikan bahwa data yang dibangkitkan memang
ARMA(2,2) dan sesuai dengan teori yang ada dimana pada lag kedua hingga
seterusnya nilai ACF akan menurun perlahan secara eksponensial.

### Plot PACF

```{r}
par(mfrow = c(1, 2))
pacf(arma22_fungsi, main="PACF dari Data ARMA(2,2) Fungsi")
pacf(y.arma, main="PACF dari Data ARMA(2,2) Manual")
```

Berdasarkan plot PACF tersebut, terlihat bahwa model ARMA(2,2) hasil
simulasi memiliki plot PACF yang *tails off*. Hal Ini membuktikan sifat
proses ARMA(2,2), dimana pada lag kedua hingga seterusnya, nilai PACF
menurun perlahan secara eksponensial.

### Plot EACF

```{r}
TSA::eacf(y.arma)
TSA::eacf(arma22_fungsi)
```

Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga
nol berada pada ordo AR(2) dan ordo MA(2)

### Scatterplot Antar Lag

```{r}
yt_1arma <- arma22_fungsi[-1]
yt_1_arma <- arma22_fungsi[-300]
plot(y=yt_1arma,x=yt_1_arma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan
positif antara $Y_t$ dengan $Y_{t-1}$. Hal ini sesuai dengan teori yang
ada

```{r}
yt_2arma <- y.arma[-c(1,2)]
yt_2_arma <- arma22_fungsi[-c(299, 300)]
plot(x = yt_2_arma, y = yt_2arma,
     main = "Scatterplot Yt vs Yt-2",
     xlab = "Yt-2 (Lag 2)",
     ylab = "Yt (Original)")
```

Pola acak ini menunjukkan bahwa tidak terdapat korelasi linear yang kuat
antara $Y_t$ dan $Y_t−2$. Autokorelasi pada lag 2 sangat lemah atau
mendekati nol.

```{r}
yt_3arma <- y.arma[-c(1,2,3)]
yt_3_arma <- arma22_fungsi[-c(298, 299, 300)]
plot(x = yt_3_arma, y = yt_3arma,
     main = "Scatterplot Yt vs Yt-3",
     xlab = "Yt-3 (Lag 3)",
     ylab = "Yt (Original)")
```

Pola sebaran yang acak ini mengindikasikan bahwa tidak ada korelasi
linear yang kuat antara nilai $Y_t$ dengan nilai $Y_t−3$.

### Korelasi antara $Y_t$ dengan $Y_{t-1}$, $Y_{t-2}$, $Y_{t-3}$ Pakai Fungsi

```{r}
cor(yt_1arma,yt_1_arma)
```

```{r}
cor(yt_2arma, yt_2_arma)
```

```{r}
cor(yt_3arma, yt_3_arma)
```

Secara keseluruhan, hasil perhitungan menunjukkan adanya autokorelasi
yang kuat dan signifikan pada lag 1, namun tidak ada autokorelasi yang
signifikan pada lag 2 dan lag 3.

### Korelasi antara $Y_t$ dengan $Y_{t-1}$, $Y_{t-2}$, $Y_{t-3}$ Pakai Perhitungan Teoritis

```{r}
phi1  <- 0.5
phi2  <- 0.2
theta1 <- 0.4
theta2 <- 0.6
sigma2 <- 1  

psi <- numeric(11)
psi[1] <- theta1 + phi1
psi[2] <- theta2 + phi1*psi[1] + phi2
for(k in 3:10){
  psi[k] <- phi1*psi[k-1] + phi2*psi[k-2]
}

gamma <- numeric(5)
for(k in 0:4){
  gamma[k+1] <- sigma2 * sum(psi[1:(11-k)] * psi[(1+k):11])
}

rho <- gamma / gamma[1]
rho[1:5]
```

Terlihat bahwa nilai autokorelasi pada kedua set data menunjukkan
kemiripan pada lag 1, di mana keduanya sama-sama memiliki nilai korelasi
positif yang sangat kuat. Meskipun, terdapat perbedaan yang fundamental
pada kecepatan penurunannya, di mana hasil hitung manual meluruh secara
perlahan khas proses AR, sementara hasil simulasi ARMA terpotong secara
drastis pada lag-lag berikutnya.
